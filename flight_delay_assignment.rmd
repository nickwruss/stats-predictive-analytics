---
title: "Flight Delay Analysis"
author: "Brett Jenkins"
date: "09/30/21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load packages
library(tidyverse) 

# Load data
d <- read_csv("flight_delay_clean.csv")

# Inspect data
glimpse(d)
summary(d)

```

### Q1

Compute the mean, median, 90th percentile, and standard deviation of arrival delay minutes for RegionEx flights. Do the same for MDA flights. Which measure of central tendency would be most appropriate for comparing airline performance?

```{r}
d %>%
  group_by(airline) %>%
  summarize(avg_delay = mean(delay),
            med_delay = median(delay),
            delay_pct_90 = quantile(delay, prob = .9),
            delay_sd = sd(delay))
            
```

> The median delay is a better measure of central tendency in this instance. Though, on average, RegionEx has a higher delay rate, since they have a wider spread in their delays some very high delays are causing the average to shift to the right. The median delay is a better measure since it shows that 50% of the time RegionEx is only delayed 9 minutes.

### Q2

Inspect the distribution of RegionEx's arrival delays by constructing a histogram of the number of arrival delay minutes of RegionEx's flights. Do the same for MDA's flights. How do these two distributions compare? Hint:  use facet_wrap().

```{r}
d %>%
  group_by(airline) %>%
  count(delay)

ggplot(d, aes(x = delay)) +
         geom_histogram(binwidth = 15) +
         facet_wrap(~airline)

```

```{r}
d %>%
  group_by(airline) %>%
  count(delay > 50)

((16 / (224 + 16)) * 100)
```
> MDA has a much more normal curve while RegionEx has a much more skewed graph. A few flights from both airlines get in ahead of schedule, and most flights getting in on time. They differe with a few very high value delays RegionEx has from 50 minutes to 150 minutes. 

### Q3

So far we have considered airline performance in terms of average delay in minutes.  However, the performance metrics, as noted in the case description, also include the percentage of delayed flights.  Let's verify that MDA's COO is correct: does RegionEx have a higher percentage of delayed flights?

Here is code to answer that question:

```{r}
# Create a summary table of percent delayed by airline.
d %>% 
  group_by(airline) %>% 
  summarize(n = n(),
            percent_delay = (mean(delay_indicator) * 100) %>% round(1)) 

```

Note that because `delay_indicator` is numeric (a binary 0/1 variable) calculating the mean of the vector returns the proportion of 1s, which, multiplied by 100, is equivalent to the *percentage* of delayed flights.

Write your own code to create a table summarizing the percentage of delayed flights by airline *and route.*  

```{r}
d %>%
  group_by(route_code, airline) %>%
  summarize(percent_delay = (mean(delay_indicator) * 100) %>%
              round(1))
```

These tables contain conflicting information. How should you answer the question of whether RegionEx has a higher percentage of delayed flights?  Is the COO correct?  And, if not, why not?

> On aggregate, the COO would be correct, RegionEx does have a few much longer delays than MDA which would indicate the RegionEx's average is much higher. However, when you break down the flights by route, the effect of each high outlier is weighted less in proportion to the high proportion of on-time flights RegionEx brings in.

### Q4

Compare the scheduled flight durations for the two airlines on each of their four routes. Compare the actual flight durations. What do you notice? If the two airlines had the same scheduled duration, what impact would this have on their delay records?

```{r}
d %>%
  group_by(route_code, airline) %>%
  summarize(sched_flight_length = mean(scheduled_flight_length),
            act_flight_length = mean(actual_flight_length))
```

> For each route MDA has a 5-10 minute longer scheduled flight lenth than RegionEx. If RegionEx were to schedule their flights for the same duration that MDA does, many more of RegionEx's flights would come in without a delay, lowering their average delay percentage.

## Q5

Does the data support the claim that the onâ€time performance of RegionEx is worse than that of MDA? Write a paragraph in which you argue a position. In your answer, please incorporate the quantitative evidence you have developed above.

> RegionEx does not perform worse than MDA. MDA schedules flights for 5-10 minutes longer than RegionEx, allowing for more leeway on hitting their target. MDA does have a lower delayed flight percentage in aggregate at 25.8% vs. RegionEx's delayed flight percentage of 26.2%, but when broken out by route RegionEx has a delayed percentage from 0 - 1.1 ppts lower than MDA. A few extremely high delays, above 50 minutes, skews RegionEx's aggregate delayed flight percentage average to seem higher than representative of their performance. These high outliers account for 6.67% of all RegionEx flights; such severe delays can be expected for such a high quantity and frequent of flight service.
